(function(i,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(i=typeof globalThis<"u"?globalThis:i||self,b(i.GanttChart={}))})(this,(function(i){"use strict";const b={viewMode:"Day",phasePanelWidth:200,rowHeight:40,headerHeight:65,upperFormat:"MMMM YYYY",lowerFormat:"DD",readonly:!1,readonlyDates:!1,readonlyProgress:!1,onClick:()=>{},onDateChange:()=>{},onProgressChange:()=>{},onViewChange:()=>{},padding:{Day:{amount:1,unit:"week"},Week:{amount:1,unit:"month"},Month:{amount:1,unit:"year"},Year:{amount:2,unit:"year"}}};function Q(s){if(typeof s!="object"||s===null)return!1;const t=s;return typeof t.id=="string"&&typeof t.name=="string"&&typeof t.color=="string"}function K(s){if(typeof s!="object"||s===null)return!1;const t=s;return typeof t.id=="string"&&typeof t.name=="string"&&typeof t.start=="string"&&typeof t.end=="string"&&typeof t.progress=="number"&&Array.isArray(t.dependencies)&&t.dependencies.every(e=>typeof e=="string")&&typeof t.phase=="string"&&(t.color===void 0||typeof t.color=="string")}function L(s){if(typeof s!="object"||s===null)return!1;const t=s;return Array.isArray(t.phases)&&t.phases.every(Q)&&Array.isArray(t.tasks)&&t.tasks.every(K)}async function Z(s){try{const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch data: ${t.status} ${t.statusText}`);const e=await t.json();if(!L(e))throw new Error("Invalid Gantt data format");return e}catch(t){throw t instanceof Error?new Error(`Failed to load Gantt data: ${t.message}`):new Error("Failed to load Gantt data: Unknown error")}}function tt(s){return L(s)}function p(s){if(s instanceof Date){if(isNaN(s.getTime()))throw new Error("Invalid Date object");return new Date(s)}if(typeof s=="number"){const t=new Date(s);if(isNaN(t.getTime()))throw new Error(`Invalid timestamp: ${s}`);return t}if(typeof s=="string"){const t=new Date(s);if(isNaN(t.getTime()))throw new Error(`Invalid date string: ${s}`);return t}throw new Error(`Unsupported date input type: ${typeof s}`)}function et(s){try{return typeof s!="string"&&typeof s!="number"&&!(s instanceof Date)?!1:(p(s),!0)}catch{return!1}}function nt(s){const t=s.getFullYear(),e=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${t}-${e}-${n}`}const _=["January","February","March","April","May","June","July","August","September","October","November","December"],M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],st=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function y(s,t){const e=s.getFullYear(),n=s.getMonth(),r=s.getDate(),a=s.getDay();switch(t){case"YYYY-MM-DD":return`${e}-${String(n+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`;case"YYYY-MM":return`${e}-${String(n+1).padStart(2,"0")}`;case"YYYY":return`${e}`;case"MMM DD":return`${M[n]} ${String(r).padStart(2,"0")}`;case"MMM DD, YYYY":return`${M[n]} ${String(r).padStart(2,"0")}, ${e}`;case"DD MMM":return`${String(r).padStart(2,"0")} ${M[n]}`;case"DD MMM YYYY":return`${String(r).padStart(2,"0")} ${M[n]} ${e}`;case"ddd, MMM DD":return`${st[a]}, ${M[n]} ${String(r).padStart(2,"0")}`;case"MMMM YYYY":return`${_[n]} ${e}`;case"MMMM":return`${_[n]}`;case"Quarter":return`Q${Math.floor(n/3)+1}`;case"DD":return`${String(r).padStart(2,"0")}`;default:const h=t;throw new Error(`Unsupported format: ${h}`)}}function g(s,t,e){const n=new Date(s);switch(e){case"millisecond":n.setMilliseconds(n.getMilliseconds()+t);break;case"second":n.setSeconds(n.getSeconds()+t);break;case"minute":n.setMinutes(n.getMinutes()+t);break;case"hour":n.setHours(n.getHours()+t);break;case"day":n.setDate(n.getDate()+t);break;case"week":n.setDate(n.getDate()+t*7);break;case"month":n.setMonth(n.getMonth()+t);break;case"year":n.setFullYear(n.getFullYear()+t);break;case"quarter":n.setMonth(n.getMonth()+t*3);break;default:const r=e;throw new Error(`Unsupported unit: ${r}`)}return n}function O(s,t,e){return g(s,-t,e)}function V(s,t,e,n={}){const{fractional:r=!1,round:a="floor"}=n,h=s.getTime(),d=t.getTime(),o=h-d;let c;switch(e){case"millisecond":c=o;break;case"second":c=o/1e3;break;case"minute":c=o/(1e3*60);break;case"hour":c=o/(1e3*60*60);break;case"day":c=o/(1e3*60*60*24);break;case"week":c=o/(1e3*60*60*24*7);break;case"quarter":c=o/(1e3*60*60*24*30.44*3);break;case"month":c=o/(1e3*60*60*24*30.44);break;case"year":c=o/(1e3*60*60*24*365.25);break;default:const l=e;throw new Error(`Unsupported unit: ${l}`)}if(r)return c;switch(a){case"floor":return Math.floor(c);case"ceil":return Math.ceil(c);case"round":return Math.round(c);default:const l=a;throw new Error(`Unsupported rounding: ${l}`)}}function rt(s,t){return V(t,s,"day",{round:"ceil"})}function T(s,t){const e=new Date(s);switch(t){case"year":e.setMonth(0,1),e.setHours(0,0,0,0);break;case"month":e.setDate(1),e.setHours(0,0,0,0);break;case"quarter":const n=Math.floor(e.getMonth()/3)*3;e.setMonth(n,1),e.setHours(0,0,0,0);break;case"week":const r=e.getDay();e.setDate(e.getDate()-r),e.setHours(0,0,0,0);break;case"day":e.setHours(0,0,0,0);break;case"hour":e.setMinutes(0,0,0);break;case"minute":e.setSeconds(0,0);break;case"second":e.setMilliseconds(0);break;case"millisecond":break;default:const a=t;throw new Error(`Unsupported unit: ${a}`)}return e}function at(s,t){const e=new Date(s);switch(t){case"year":e.setMonth(11,31),e.setHours(23,59,59,999);break;case"month":e.setMonth(e.getMonth()+1,0),e.setHours(23,59,59,999);break;case"quarter":const n=Math.floor((e.getMonth()+1)/3)*3-1;e.setMonth(n,31),e.setHours(23,59,59,999);break;case"week":const r=e.getDay();e.setDate(e.getDate()+(6-r)),e.setHours(23,59,59,999);break;case"day":e.setHours(23,59,59,999);break;case"hour":e.setMinutes(59,59,999);break;case"minute":e.setSeconds(59,999);break;case"second":e.setMilliseconds(999);break;case"millisecond":break;default:const a=t;throw new Error(`Unsupported unit: ${a}`)}return e}function Y(s){const t=s.match(/^(\d+)([dwmy])$/);if(!t)throw new Error(`Invalid duration format: ${s}. Expected format: "5d", "2w", "3m", or "1y"`);const e=parseInt(t[1],10),n=t[2];let r;switch(n){case"d":r="day";break;case"w":r="week";break;case"m":r="month";break;case"y":r="year";break;default:throw new Error(`Unsupported duration unit: ${n}`)}return{amount:e,unit:r}}function it(s,t){const{amount:e,unit:n}=Y(t);return g(s,e,n)}function ot(s,t){const{amount:e,unit:n}=Y(t);return O(s,e,n)}function ht(s,t){return s.getTime()<t.getTime()}function ct(s,t){return s.getTime()>t.getTime()}function dt(s,t){return s.getFullYear()===t.getFullYear()&&s.getMonth()===t.getMonth()&&s.getDate()===t.getDate()}function lt(s,t,e){const n=s.getTime();return n>=t.getTime()&&n<=e.getTime()}function B(...s){if(s.length===0)throw new Error("Cannot find minimum of empty array");return new Date(Math.min(...s.map(t=>t.getTime())))}function $(...s){if(s.length===0)throw new Error("Cannot find maximum of empty array");return new Date(Math.max(...s.map(t=>t.getTime())))}function ut(s){return new Date(s)}function gt(){return T(new Date,"day")}const x={minWidth:10,maxWidth:1/0,heightRatio:.7,verticalPadding:6,cornerRadius:4,showLabels:!0,labelFontSize:12,showProgress:!0,progressOpacity:.4},pt={height:24,cornerRadius:4,showLabel:!0,minLabelWidth:80},k={Day:{columnWidth:30,step:1,unit:"day",lowerFormat:"DD",upperFormat:"MMMM YYYY"},Week:{columnWidth:80,step:1,unit:"week",lowerFormat:"DD",upperFormat:"MMMM YYYY"},Month:{columnWidth:120,step:1,unit:"month",lowerFormat:"MMMM",upperFormat:"YYYY"},Quarter:{columnWidth:100,step:1,unit:"quarter",lowerFormat:"Quarter",upperFormat:"YYYY"},Year:{columnWidth:180,step:1,unit:"quarter",lowerFormat:"Quarter",upperFormat:"YYYY"}};function H(s){return k[s]}function D(s,t,e){const n=k[e],r=s.getTime()-t.getTime();let a;switch(n.unit){case"day":a=r/(1e3*60*60*24);break;case"week":a=r/(1e3*60*60*24*7);break;case"month":a=r/(1e3*60*60*24*30.44);break;case"quarter":a=r/(1e3*60*60*24*30.44*3);break;case"year":a=r/(1e3*60*60*24*365.25);break;default:throw new Error(`Unsupported unit: ${n.unit}`)}return a*n.columnWidth}function ft(s,t,e){const n=k[e],r=s/n.columnWidth;return g(t,r,n.unit)}function W(s,t,e){const n=k[e],r=[];let a=T(s,n.unit);for(;a<=t;)r.push({date:new Date(a),label:y(a,n.lowerFormat),width:n.columnWidth}),a=g(a,n.step,n.unit);return r}const wt={height:24,cornerRadius:3,opacity:.3,showLabels:!0,labelFontSize:12,labelColor:"#2c3e50"};function G(s,t,e,n,r={}){const a={...x,...r},h=p(s.start),d=p(s.end),o=D(h,e,n);let l=D(d,e,n)-o;l=Math.max(l,a.minWidth),l=Math.min(l,a.maxWidth);const u=t.height*a.heightRatio,w=t.y+a.verticalPadding;return{x:Math.round(o),y:Math.round(w),width:Math.round(l),height:Math.round(u)}}function F(s,t,e,n={}){({...n});const r=s.tasks.flatMap(u=>[p(u.start),p(u.end)]);if(r.length===0)return{x:0,y:0,width:0,height:0};const a=B(...r),h=$(...r),d=D(a,t,e),c=D(h,t,e)-d,l=s.y;return{x:Math.round(d),y:Math.round(l),width:Math.round(c),height:Math.round(s.height)}}function mt(s,t,e){return s.x+s.width>=t&&s.x<=e}function R(s,t,e){const n=e*.6,r=Math.floor(t/n);return r<3?"":s.length<=r?s:s.substring(0,r-3)+"..."}function z(s,t){return Math.round(s*t/100)}function U(s){const t=s.replace("#",""),e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);return(.299*e+.587*n+.114*r)/255>.5?"#000000":"#ffffff"}const bt="http://www.w3.org/2000/svg";function m(s,t={}){const e=document.createElementNS(bt,s);return q(e,t),e}function q(s,t){Object.entries(t).forEach(([e,n])=>{n!==void 0&&s.setAttribute(e,String(n))})}function f(s){return m("rect",s)}function E(s){return m("line",s)}function S(s,t={}){const e=m("text",t);return e.textContent=s,e}function Mt(s){return m("path",s)}function v(s={}){return m("g",s)}function P(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function yt(s,t){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}function kt(s,t){return s.x>=t.x&&s.x<=t.x+t.width&&s.y>=t.y&&s.y<=t.y+t.height}function Dt(s,t,e){return Math.min(Math.max(s,t),e)}let Et=0;function St(s="gantt"){return`${s}-${Date.now()}-${Et++}`}function vt(s,t){const e=s.getScreenCTM();return e?{x:(t.clientX-e.e)/e.a,y:(t.clientY-e.f)/e.d}:{x:t.clientX,y:t.clientY}}class j{task;taskRow;viewStart;viewMode;config;dimensions;color;group;constructor(t,e,n,r,a={}){this.task=t,this.taskRow=e,this.viewStart=n,this.viewMode=r,this.config={...x,...a},this.dimensions=G(t,e,n,r,this.config),this.color=t.color||e.phase.color,this.group=this.createBarGroup()}createBarGroup(){const t=v({class:"task-bar","data-task-id":this.task.id}),e=this.createBackground();if(t.appendChild(e),this.config.showProgress&&this.task.progress>0){const n=this.createProgress();t.appendChild(n)}if(this.config.showLabels&&this.dimensions.width>30){const n=this.createLabel();n&&t.appendChild(n)}return t}createBackground(){return f({x:this.dimensions.x,y:this.dimensions.y,width:this.dimensions.width,height:this.dimensions.height,rx:this.config.cornerRadius,fill:this.color,stroke:this.darkenColor(this.color,.1),"stroke-width":1,class:"bar-background"})}createProgress(){const t=z(this.dimensions.width,this.task.progress);return f({x:this.dimensions.x,y:this.dimensions.y,width:t,height:this.dimensions.height,rx:this.config.cornerRadius,fill:this.darkenColor(this.color,.2),opacity:this.config.progressOpacity,class:"bar-progress"})}createLabel(){const e=this.dimensions.width-16;if(e<20)return null;const n=R(this.task.name,e,this.config.labelFontSize);if(!n)return null;const r=U(this.color);return S(n,{x:this.dimensions.x+8,y:this.dimensions.y+this.dimensions.height/2,"font-size":this.config.labelFontSize,"font-weight":500,fill:r,"dominant-baseline":"middle",class:"bar-label"})}darkenColor(t,e){const n=t.replace("#","");let r=parseInt(n.substring(0,2),16),a=parseInt(n.substring(2,4),16),h=parseInt(n.substring(4,6),16);r=Math.round(r*(1-e)),a=Math.round(a*(1-e)),h=Math.round(h*(1-e));const d=r.toString(16).padStart(2,"0"),o=a.toString(16).padStart(2,"0"),c=h.toString(16).padStart(2,"0");return`#${d}${o}${c}`}getElement(){return this.group}getInfo(){return{task:this.task,taskRow:this.taskRow,dimensions:this.dimensions,color:this.color,element:this.group}}update(t,e){this.viewStart=t,this.viewMode=e,this.dimensions=G(this.task,this.taskRow,t,e,this.config);const n=this.createBarGroup();this.group.parentNode&&this.group.parentNode.replaceChild(n,this.group),this.group=n}destroy(){this.group.parentNode&&this.group.parentNode.removeChild(this.group)}}class Ct{phaseInfo;viewStart;viewMode;config;dimensions;group;constructor(t,e,n,r={}){this.phaseInfo=t,this.viewStart=e,this.viewMode=n,this.config={...wt,...r},this.dimensions=F(t,e,n,this.config),this.group=this.createPhaseBarGroup()}createPhaseBarGroup(){const t=v({class:"phase-bar","data-phase-id":this.phaseInfo.phase.id}),e=this.createBackground();if(t.appendChild(e),this.config.showLabels&&this.dimensions.width>20){const n=this.createLabel();n&&t.appendChild(n)}return t}createBackground(){return f({x:this.dimensions.x,y:this.dimensions.y,width:this.dimensions.width,height:this.dimensions.height,rx:this.config.cornerRadius,fill:this.phaseInfo.phase.color,opacity:this.config.opacity,class:"phase-bar-background"})}createLabel(){const e=this.dimensions.width-16;if(e<20)return null;const n=R(this.phaseInfo.phase.name,e,this.config.labelFontSize);return n?S(n,{x:this.dimensions.x+8,y:this.dimensions.y+this.dimensions.height/2,"font-size":this.config.labelFontSize,"font-weight":600,fill:this.config.labelColor,"dominant-baseline":"middle",class:"phase-bar-label"}):null}getElement(){return this.group}getInfo(){return{phase:this.phaseInfo.phase,dimensions:this.dimensions,element:this.group}}update(t,e){this.viewStart=t,this.viewMode=e,this.dimensions=F(this.phaseInfo,t,e,this.config);const n=this.createPhaseBarGroup();this.group.parentNode&&this.group.parentNode.replaceChild(n,this.group),this.group=n}destroy(){this.group.parentNode&&this.group.parentNode.removeChild(this.group)}}function A(s,t,e){const n=[],r=[];let a=0;s.phases.forEach(d=>{const o=s.tasks.filter(C=>C.phase===d.id);if(o.length===0)return;const c=a;o.forEach(C=>{const I=e+a*t;n.push({task:C,phase:d,rowIndex:a,y:I,height:t}),a++});const l=a-1,u=o.length*t,w=e+c*t,xt=o.reduce((C,I)=>C+I.progress,0),Ht=o.length>0?Math.round(xt/o.length):0;r.push({phase:d,tasks:o,startRow:c,endRow:l,y:w,height:u,averageProgress:Ht})});const h=e+a*t;return{taskRows:n,phases:r,totalRows:a,totalHeight:h}}function N(s,t){return t.taskRows.find(e=>e.task.id===s)}function Pt(s,t){return t.phases.find(e=>e.phase.id===s)}function Tt(s,t){return t.taskRows.find(e=>e.rowIndex===s)}function Yt(s,t){const e=N(s,t);if(e)return t.phases.find(n=>n.phase.id===e.phase.id)}class J{data;rowMapping;viewStart;viewMode;config;container;bars;phaseBars;phaseBarsVisible=!0;phaseLabelsVisible=!0;constructor(t,e,n,r,a,h={}){this.container=t,this.data=e,this.rowMapping=n,this.viewStart=r,this.viewMode=a,this.config=h,this.bars=new Map,this.phaseBars=new Map,this.renderBars()}renderBars(){this.clearBars(),this.renderPhaseBars(),this.data.tasks.forEach(t=>{const e=N(t.id,this.rowMapping);if(!e){console.warn(`Task row not found for task: ${t.id}`);return}const n=new j(t,e,this.viewStart,this.viewMode,this.config);this.container.appendChild(n.getElement()),this.bars.set(t.id,n)}),console.log(`Rendered ${this.bars.size} task bars`)}clearBars(){this.bars.forEach(t=>t.destroy()),this.bars.clear()}renderPhaseBars(){this.clearPhaseBars(),this.phaseBarsVisible&&this.rowMapping.phases.forEach(t=>{const e=new Ct(t,this.viewStart,this.viewMode,{showLabels:this.phaseLabelsVisible});this.container.appendChild(e.getElement()),this.phaseBars.set(t.phase.id,e)})}clearPhaseBars(){this.phaseBars.forEach(t=>t.destroy()),this.phaseBars.clear()}updateViewMode(t,e){this.viewStart=t,this.viewMode=e,this.bars.forEach(n=>{n.update(t,e)}),this.phaseBars.forEach(n=>{n.update(t,e)})}setPhaseBarsVisibility(t){this.phaseBarsVisible=t,this.renderPhaseBars()}setPhaseLabelsVisibility(t){this.phaseLabelsVisible=t,this.renderPhaseBars()}update(t,e,n,r){this.data=t,this.rowMapping=e,this.viewStart=n,this.viewMode=r,this.renderBars()}getBar(t){return this.bars.get(t)}getBars(){return this.bars}highlightBar(t){this.bars.forEach((e,n)=>{const r=e.getElement();r.style.opacity=t&&n!==t?"0.5":"1"})}destroy(){this.clearBars(),this.clearPhaseBars()}}class Bt{svg;headerGroup;bodyGroup;viewMode;viewStart;viewEnd;rowHeight;headerHeight;taskCount;barManager=null;data=null;rowMapping=null;constructor(t,e,n,r,a,h,d,o,c){this.viewMode=e,this.viewStart=n,this.viewEnd=r,this.rowHeight=a,this.headerHeight=h,this.taskCount=d,this.data=o||null,this.rowMapping=c||null,this.svg=m("svg",{width:"100%",height:"100%",class:"gantt-svg"}),this.headerGroup=v({class:"gantt-header"}),this.bodyGroup=v({class:"gantt-body"}),this.svg.appendChild(this.headerGroup),this.svg.appendChild(this.bodyGroup),P(t),t.appendChild(this.svg),this.render(),this.data&&this.rowMapping&&this.renderBars()}render(){P(this.bodyGroup),P(this.headerGroup);const t=H(this.viewMode),e=W(this.viewStart,this.viewEnd,this.viewMode);if(e.length===0){this.svg.setAttribute("width","100%"),this.svg.setAttribute("height",`${this.headerHeight}px`);return}const n=e.length*t.columnWidth,r=this.svg.parentElement?.clientWidth??n,a=n<r?r/e.length:t.columnWidth,h=e.length*a,d=this.taskCount*this.rowHeight;this.svg.setAttribute("width",`${h}px`),this.svg.setAttribute("height",`${this.headerHeight+d}px`),this.renderGridBody(e,a,h,d),this.renderHeaders(e,a,h)}renderBars(){!this.data||!this.rowMapping||(this.barManager=new J(this.bodyGroup,this.data,this.rowMapping,this.viewStart,this.viewMode))}renderGridBody(t,e,n,r){const a=f({x:0,y:this.headerHeight,width:n,height:r,fill:"#ffffff",class:"grid-background"});this.bodyGroup.appendChild(a);for(let h=0;h<=this.taskCount;h++){const d=this.headerHeight+h*this.rowHeight;this.bodyGroup.appendChild(E({x1:0,y1:d,x2:n,y2:d,class:"grid-row-line"}))}t.forEach((h,d)=>{const o=d*e;this.bodyGroup.appendChild(E({x1:o,y1:this.headerHeight,x2:o,y2:this.headerHeight+r,class:"grid-column-line"}))}),this.bodyGroup.appendChild(E({x1:n,y1:this.headerHeight,x2:n,y2:this.headerHeight+r,class:"grid-column-line"}))}renderHeaders(t,e,n){const r=this.headerHeight/2,a=this.headerHeight/2;this.headerGroup.appendChild(f({x:0,y:0,width:n,height:this.headerHeight,class:"header-background"})),this.renderUpperHeader(t,e,r),this.renderLowerHeader(t,e,r,a),this.headerGroup.appendChild(E({x1:0,y1:this.headerHeight,x2:n,y2:this.headerHeight,class:"header-border"}))}renderUpperHeader(t,e,n){const a=H(this.viewMode).upperFormat,h=[];let d="",o=0,c=0;t.forEach((l,u)=>{const w=y(l.date,a);w!==d?(c>0&&h.push({label:d,start:o,width:c}),d=w,o=u*e,c=e):c+=e}),c>0&&h.push({label:d,start:o,width:c}),h.forEach(l=>{const u=f({x:l.start,y:0,width:l.width,height:n,fill:"transparent",stroke:"#dee2e6","stroke-width":1,class:"upper-header-cell"});this.headerGroup.appendChild(u);const w=S(l.label,{x:l.start+l.width/2,y:n/2,"text-anchor":"middle","dominant-baseline":"middle","font-size":14,"font-weight":600,fill:"#495057",class:"upper-header-text"});this.headerGroup.appendChild(w)})}renderLowerHeader(t,e,n,r){t.forEach((a,h)=>{const d=h*e,o=f({x:d,y:n,width:e,height:r,fill:"transparent",stroke:"#dee2e6","stroke-width":1,class:"lower-header-cell"});this.headerGroup.appendChild(o);const c=S(a.label,{x:d+e/2,y:n+r/2,"text-anchor":"middle","dominant-baseline":"middle","font-size":12,fill:"#6c757d",class:"lower-header-text"});this.headerGroup.appendChild(c)})}getSVG(){return this.svg}getBodyGroup(){return this.bodyGroup}setViewMode(t){this.viewMode=t,this.render(),this.barManager&&this.data&&this.rowMapping&&this.barManager.updateViewMode(this.viewStart,t)}getBarManager(){return this.barManager}}class X{container;data;rowMapping;config;constructor(t,e,n,r){this.container=t,this.data=e,this.rowMapping=n,this.config={showProgress:!0,showTaskCount:!0,...r},this.render()}render(){this.container.innerHTML="";const t=this.createHeader();this.container.appendChild(t),this.rowMapping.phases.forEach(e=>{const n=this.createPhaseBlock(e);this.container.appendChild(n)})}createHeader(){const t=document.createElement("div");return t.className="phase-panel-header",t.style.cssText=`
      height: ${this.config.headerHeight}px;
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
      display: flex;
      align-items: center;
      padding: 0 16px;
      font-weight: 600;
      font-size: 14px;
      color: #495057;
    `,t.textContent="Phases",t}createPhaseBlock(t){const e=document.createElement("div");e.className="phase-block",e.dataset.phaseId=t.phase.id,e.style.cssText=`
      height: ${t.height}px;
      border-left: 4px solid ${t.phase.color};
      border-bottom: 1px solid #e9ecef;
      background: #f8f9fa;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      overflow: hidden;
    `;const n=document.createElement("div");n.className="phase-name",n.style.cssText=`
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 4px;
    `,n.textContent=t.phase.name,e.appendChild(n);const r=document.createElement("div");if(r.style.cssText=`
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 12px;
      color: #6c757d;
    `,this.config.showTaskCount){const a=document.createElement("span");a.textContent=`${t.tasks.length} task${t.tasks.length!==1?"s":""}`,r.appendChild(a)}if(this.config.showProgress&&t.averageProgress>0){const a=document.createElement("span");a.style.cssText=`
        padding: 2px 8px;
        background: ${t.averageProgress===100?"#28a745":"#007bff"};
        color: white;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 600;
      `,a.textContent=`${t.averageProgress}%`,r.appendChild(a)}if(e.appendChild(r),this.config.showProgress&&t.averageProgress>0){const a=document.createElement("div");a.style.cssText=`
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        width: ${t.averageProgress}%;
        background: ${t.phase.color};
        opacity: 0.6;
        transition: width 0.3s ease;
      `,e.appendChild(a)}return e}update(t,e){this.data=t,this.rowMapping=e,this.render()}highlightPhase(t){if(this.container.querySelectorAll(".phase-block").forEach(n=>{n.style.background="#f8f9fa"}),t){const n=this.container.querySelector(`[data-phase-id="${t}"]`);n&&(n.style.background="#e3f2fd")}}getRowMapping(){return this.rowMapping}}class $t{data;container;config;viewStart=new Date;viewEnd=new Date;grid=null;phasePanel=null;rowMapping=null;phasePanelElement=null;ganttMain=null;scrollSyncInitialized=!1;constructor(t,e){if(this.data=t,typeof e.container=="string"){const n=document.querySelector(e.container);if(!n)throw new Error(`Container not found: ${e.container}`);this.container=n}else this.container=e.container;this.config={...b,...e,container:this.container},this.calculateDateRange(),this.rowMapping=A(this.data,this.config.rowHeight,this.config.headerHeight),console.log("GanttChart initialized with",this.data.tasks.length,"tasks"),console.log("Date range:",y(this.viewStart,"YYYY-MM-DD"),"to",y(this.viewEnd,"YYYY-MM-DD")),console.log("View mode:",this.config.viewMode),console.log("Row mapping:",this.rowMapping.totalRows,"rows"),this.render()}calculateDateRange(){if(this.data.tasks.length===0){const a=new Date;this.viewStart=new Date(a.getFullYear(),a.getMonth(),1),this.viewEnd=new Date(a.getFullYear(),a.getMonth()+1,0);return}const t=this.data.tasks.flatMap(a=>[p(a.start),p(a.end)]),e=B(...t),n=$(...t),r=this.config.padding[this.config.viewMode];if(!r){this.viewStart=g(e,-1,"month"),this.viewEnd=g(n,1,"month");return}this.viewStart=g(e,-r.amount,r.unit),this.viewEnd=g(n,r.amount,r.unit)}render(){if(this.phasePanelElement=this.container.querySelector("#phase-panel"),this.ganttMain=this.container.querySelector("#gantt-main"),!this.phasePanelElement||!this.ganttMain){console.error("Required elements not found. Make sure #phase-panel and #gantt-main exist.");return}this.scrollSyncInitialized||(this.setupScrollSync(),this.scrollSyncInitialized=!0),this.renderPhasePanel(),this.renderGrid()}setupScrollSync(){if(!this.ganttMain||!this.phasePanelElement)return;const t=this.ganttMain,e=this.phasePanelElement;t.addEventListener("scroll",()=>{e.scrollTop!==t.scrollTop&&(e.scrollTop=t.scrollTop)}),e.addEventListener("scroll",()=>{t.scrollTop!==e.scrollTop&&(t.scrollTop=e.scrollTop)})}renderPhasePanel(){!this.phasePanelElement||!this.rowMapping||(this.phasePanel=new X(this.phasePanelElement,this.data,this.rowMapping,{headerHeight:this.config.headerHeight,showProgress:!0,showTaskCount:!0}))}renderGrid(){!this.ganttMain||!this.rowMapping||(this.grid=new Bt(this.ganttMain,this.config.viewMode,this.viewStart,this.viewEnd,this.config.rowHeight,this.config.headerHeight,this.data.tasks.length,this.data,this.rowMapping))}setViewMode(t){this.config.viewMode=t,this.calculateDateRange(),this.renderGrid(),this.config.onViewChange&&this.config.onViewChange(t),console.log("View mode changed to:",t)}refresh(t){this.data=t,this.calculateDateRange(),this.rowMapping=A(this.data,this.config.rowHeight,this.config.headerHeight),this.render()}getViewMode(){return this.config.viewMode}getRowMapping(){return this.rowMapping}getPhasePanel(){return this.phasePanel}getBarManager(){return this.grid?.getBarManager()}highlightPhase(t){this.phasePanel&&this.phasePanel.highlightPhase(t)}}i.Bar=j,i.BarManager=J,i.DEFAULT_BAR_CONFIG=x,i.DEFAULT_OPTIONS=b,i.DEFAULT_PHASE_BAR_CONFIG=pt,i.GanttChart=$t,i.PhasePanel=X,i.VIEW_MODE_CONFIGS=k,i.add=g,i.addDuration=it,i.calculateBarDimensions=G,i.calculatePhaseBarDimensions=F,i.calculateProgressWidth=z,i.clamp=Dt,i.clearElement=P,i.clone=ut,i.createGroup=v,i.createLine=E,i.createPath=Mt,i.createRect=f,i.createRowMapping=A,i.createSVGElement=m,i.createText=S,i.diff=V,i.distance=yt,i.endOf=at,i.format=y,i.generateDateHeaders=W,i.generateId=St,i.getContrastTextColor=U,i.getDateForPosition=ft,i.getDurationInDays=rt,i.getEventCoordinates=vt,i.getPhaseForTask=Yt,i.getPhaseInfo=Pt,i.getPositionForDate=D,i.getTaskRow=N,i.getTaskRowByIndex=Tt,i.getViewConfig=H,i.isAfter=ct,i.isBarVisible=mt,i.isBefore=ht,i.isSameDay=dt,i.isValidDate=et,i.isWithinRange=lt,i.loadGanttData=Z,i.max=$,i.min=B,i.parse=p,i.parseDuration=Y,i.pointInRect=kt,i.setAttributes=q,i.startOf=T,i.subtract=O,i.subtractDuration=ot,i.toISODate=nt,i.today=gt,i.truncateLabel=R,i.validateGanttData=tt,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
