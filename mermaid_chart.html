<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to Mermaid SVG</title>
</head>
<body>

    <h1>Generated Class Diagram</h1>
    <p>This SVG was generated by Mermaid.js from a JSON object.</p>

    <div id="mermaid-container"></div>
    

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    </script>

    <script>
        // 3. The JSON data source for the diagram
        const jsonData = {
            "diagramType": "classDiagram",
            "direction": "LR",
            "classes": [
                {
                    "name": "GanttChart",
                    "stereotype": "Orchestrator",
                    "attributes": [
                        { "visibility": "-", "name": "taskManager", "type": "TaskManager" },
                        { "visibility": "-", "name": "renderer", "type": "Renderer" },
                        { "visibility": "-", "name": "container", "type": "HTMLElement" }
                    ],
                    "methods": [
                        { "visibility": "+", "name": "render", "parameters": [], "returnType": "void" },
                        { "visibility": "+", "name": "updateTasks", "parameters": ["tasks: RawTask[]"], "returnType": "void" },
                        { "visibility": "+", "name": "destroy", "parameters": [], "returnType": "void" }
                    ]
                },
                {
                    "name": "TaskManager",
                    "stereotype": "Data Model",
                    "attributes": [
                        { "visibility": "-", "name": "tasks", "type": "Task[]" }
                    ],
                    "methods": [
                        { "visibility": "+", "name": "getAllTasks", "parameters": [], "returnType": "Task[]" }
                    ]
                },
                {
                    "name": "Renderer",
                    "stereotype": "View",
                    "attributes": [
                        { "visibility": "-", "name": "container", "type": "HTMLElement" },
                        { "visibility": "-", "name": "config", "type": "GanttConfig" }
                    ],
                    "methods": [
                        { "visibility": "+", "name": "render", "parameters": ["tasks: Task[]"], "returnType": "void" }
                    ]
                }
            ],
            "relationships": [
                { "from": "GanttChart", "to": "TaskManager", "type": " *-- ", "cardinality": "\"1\"", "label": "owns" },
                { "from": "GanttChart", "to": "Renderer", "type": " *-- ", "cardinality": "\"1\"", "label": "owns" }
            ]
        };

        /**
         * Generates a Mermaid.js diagram definition string from a JSON object.
         * @param {object} data - The JSON object describing the diagram.
         * @returns {string} The Mermaid definition string.
         */
        function generateMermaidString(data) {
            let mermaidCode = `${data.diagramType}\n`;
            if (data.direction) {
                mermaidCode += `    direction ${data.direction}\n\n`;
            }

            // Process classes
            data.classes.forEach(cls => {
                mermaidCode += `    class ${cls.name} {\n`;
                if (cls.stereotype) {
                    mermaidCode += `        <<${cls.stereotype}>>\n`;
                }
                cls.attributes.forEach(attr => {
                    mermaidCode += `        ${attr.visibility}${attr.name}: ${attr.type}\n`;
                });
                cls.methods.forEach(method => {
                    const params = method.parameters.join(', ');
                    mermaidCode += `        ${method.visibility}${method.name}(${params}) ${method.returnType}\n`;
                });
                mermaidCode += `    }\n\n`;
            });

            // Process relationships
            data.relationships.forEach(rel => {
                mermaidCode += `    ${rel.from}${rel.type}${rel.cardinality} ${rel.to} : ${rel.label}\n`;
            });

            return mermaidCode;
        }

        // 4. Generate, render, and deploy the SVG
        document.addEventListener('DOMContentLoaded', async () => {
            const mermaidString = generateMermaidString(jsonData);
            const container = document.getElementById('mermaid-container');
            
            // Use mermaid.render to generate the SVG and then insert it
            const { svg } = await mermaid.render('graphDiv', mermaidString);
            container.innerHTML = svg;
        });
    </script>
</body>
</html>
